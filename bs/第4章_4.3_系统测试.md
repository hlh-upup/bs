## 4.3 系统测试

系统开发完成后，需要通过系统化的功能测试验证各模块是否按照预期设计正确运行。本节针对4.1节所划分的三大核心模块——数字人视频生成模块、生成视频质量评价模块以及前后端交互模块，分别设计并执行功能测试用例，展示各模块的测试过程与结果，最后从整体角度总结系统的协同运行表现。

### 4.3.1 模块功能测试

**（1）数字人视频生成模块测试**

数字人视频生成模块是系统的核心功能模块，其测试重点在于验证从课件文本输入到最终视频输出的完整生成管线是否能够正确、稳定地运行。测试围绕课件文本提取、语音合成、面部驱动渲染、视频背景处理与课件合成等关键环节逐一展开。

在课件文本提取环节的测试中，分别选取包含标准备注文本的PPT文件与不含备注的PPT文件作为测试输入。对于包含备注文本的课件，系统能够正确解析并提取各页幻灯片的备注内容，提取结果与PPT文件中的原始备注文本完全一致，各页文本以结构化列表的形式返回前端供用户审阅编辑。对于不含备注的课件，系统自动回退至全文本元素扫描策略，成功从幻灯片的标题、正文等文本元素中提取到可用文本，验证了两级文本提取策略的有效性与容错能力。

在语音合成环节的测试中，以一段时长约5秒的参考音频及其对应文本为输入，配合不同内容的课件备注文本，测试GPT-SoVITS模型的语音克隆与合成能力。测试结果表明，系统能够根据参考音频成功学习目标说话人的音色特征，并将课件备注文本逐页合成为与参考音色高度相似的语音音频文件。合成的语音在音色相似度、语句流畅度以及语调自然度方面均达到可用水平。同时测试了语速、采样温度等参数对合成结果的影响，调高语速参数后合成语音的语速明显加快，调节采样温度后语音的韵律变化程度随之改变，验证了参数配置对合成过程的有效控制能力。此外，还测试了自定义音频上传通道，用户直接上传的预录制音频文件能够被系统正确接收并跳过语音合成环节，直接进入面部驱动阶段，双通道音频输入机制工作正常。

在面部驱动渲染环节的测试中，分别对SadTalker与Wav2Lip两种驱动模型进行了功能验证。SadTalker模型测试中，以一张标准人像照片与合成的语音音频为输入，系统成功生成了包含自然头部运动与面部表情变化的说话视频。生成视频中人物的口型动作与音频内容基本同步，头部姿态呈现出自然的微幅摆动，面部表情随语音内容呈现合理的变化。进一步测试了像素级面部增强后处理功能，分别选择不同的面部修复算法执行增强处理，增强后的视频帧在面部清晰度与纹理细节方面较原始渲染输出有明显改善，面部伪影与模糊区域得到有效修复，验证了面部增强后处理环节的有效性。同时测试了表情强度、姿态幅度等参数的调节效果，增大表情强度参数后生成视频中人物的表情变化幅度相应增大，调节姿态幅度后头部运动的范围随之改变，各参数均能对生成结果产生符合预期的影响。

> **图4-3 SadTalker面部驱动渲染测试结果示例**

Wav2Lip模型测试中，以一段包含面部动作的驱动视频与对应的语音音频为输入，系统首先将驱动视频帧率统一调整至25帧/秒，然后按音频时长对视频进行分段裁剪，再逐段执行口型同步推理。测试结果显示，Wav2Lip生成的视频在口型与音频的同步精度方面表现优异，口唇运动与语音内容的时序匹配紧密，即使在快速语速条件下仍能保持较高的同步质量。

在视频背景处理与课件合成环节的测试中，验证了从视频背景透明化到课件视频合成的完整后处理流程。背景去除测试中，系统将面部驱动渲染生成的视频逐帧拆解后，对每帧执行背景分割处理，成功将人物主体从背景中分离并生成带透明通道的图像序列，透明化后的视频中人物边缘清晰，无明显分割残留。课件合成测试中，分别验证了三种合成模式的功能：全页插入模式下，数字人形象被正确嵌入每一页课件画面的指定位置；选择性插入模式下，仅用户指定的页面被嵌入数字人形象，其余页面保持原始课件画面；无插入模式下，系统仅将语音音轨与课件视频进行合并，输出不含数字人形象的教学视频。三种模式均能正确输出最终视频成品，音画同步效果良好。

> **图4-4 课件视频合成测试结果示例（三种合成模式）**

**（2）生成视频质量评价模块测试**

生成视频质量评价模块的测试旨在验证评价服务能否在视频生成完成后自动完成多维度质量评分，并输出准确、可靠的评价结果。

在评价服务触发与执行测试中，完成一次完整的视频生成流程后，观察评价服务是否被正确触发。测试结果表明，当推理线程将任务状态标记为"成功"后，后端服务在短时间内自动启动了质量评价流程，评价服务成功接收到生成视频的文件路径与模型配置参数，并完成了从特征提取到模型推理再到评分汇总的完整评估流程。评价过程未阻塞主推理线程，评价完成后结构化评分结果被正确返回至后端服务。同时测试了评价过程中的异常处理能力，当人为传入无效的视频文件路径时，评价服务能够捕获异常并返回错误信息，而不会导致系统崩溃或影响已生成视频的正常使用，验证了评价服务与主推理流程解耦设计的健壮性。

在多模态特征提取测试中，选取不同质量水平的生成视频作为输入，验证特征提取的覆盖度与准确性。测试结果显示，系统能够正确完成四个模态维度的特征提取：视觉特征方面，逐帧采样与深度卷积网络特征提取过程正常，输出的特征向量维度与预期一致；音频特征方面，音轨分离与声学特征提取正常运行，特征向量准确反映了音频的声学属性；面部关键点特征方面，面部检测与关键点定位模型成功定位各帧的人脸区域并提取关键点坐标序列；面部动作单元特征方面，各帧的动作单元激活强度被正确提取，特征维度与配置一致。四类特征经维度对齐与标准化后，形成的多模态特征表示能够被评价模型正确接收。

在评分输出验证测试中，对多段不同质量水平的生成视频执行质量评价，检验评分结果的合理性与区分度。测试结果表明，评价模型输出的各分项指标——口型同步得分、表情自然度得分、音频质量得分、跨模态一致性得分以及综合评分——均归一化至统一数值区间，数值范围符合预期。对于口型同步效果较好的视频，其口型同步得分明显高于同步效果较差的视频；对于面部表情变化自然流畅的视频，其表情自然度得分也相应较高。各分项得分能够合理反映视频在对应维度上的质量水平，综合评分则与各分项得分的整体趋势保持一致，验证了评价模型的区分能力与评分的合理性。

在优化建议生成测试中，验证系统能否根据评分结果自动生成有针对性的参数优化建议。测试中选取口型同步得分偏低但其他维度正常的视频，系统正确识别口型同步为当前质量瓶颈，并推荐用户尝试切换至口型同步精度更高的面部驱动模型或调整相关音频参数。选取表情自然度得分不佳的视频，系统建议适当增大表情强度参数或使用表情表现力更强的驱动模型。各类建议与对应的质量薄弱维度匹配准确，措辞清晰具有可操作性，能够有效引导用户进行下一轮参数调整。

> **图4-5 质量评价结果展示界面**

**（3）前后端交互模块测试**

前后端交互模块的测试覆盖用户认证、素材上传与参数配置、异步任务状态管理以及生成结果展示与管理等核心交互功能。

在用户认证功能测试中，分别使用正确与错误的用户凭据进行登录操作。输入正确的用户名与密码后，系统成功完成身份验证，前端页面跳转至工作台主界面，登录状态被正确保存至本地存储，刷新页面后用户仍保持登录态。输入错误凭据时，前端界面显示明确的错误提示信息，未发生页面跳转。测试路由守卫机制，未登录状态下直接访问工作台页面时，系统自动将请求重定向至登录页面，验证了认证保护机制的有效性。执行退出登录操作后，本地存储的认证信息被清除，再次访问工作台页面时被正确拦截并重定向至登录页面。

> **图4-6 用户登录界面测试**

在素材上传功能测试中，依次验证了人像照片上传、PPT课件上传以及训练音频上传等功能。人像照片上传测试中，通过形象管理页面的上传入口选择一张人像图片，系统正确接收图片并将其调整为模型要求的尺寸规格后保存至用户独立数据空间，上传完成后页面展示上传成功的反馈信息。同时测试了图像风格化功能，选择将真实人像转换为动漫风格后，系统调用风格化算法成功生成了动漫风格的人像图片，用户可在原始图像与风格化图像之间进行预览对比与切换选择。PPT课件上传测试中，上传一份包含多页幻灯片的PPT文件，系统自动完成解析并将各页备注文本以可编辑列表的形式展示于页面上，用户能够对提取的文本进行逐页编辑与确认。训练音频上传测试中，在语音训练页面上传多段WAV格式的音频文件，系统正确接收并显示各段音频的文件名与时长信息，用户可为每段音频标注对应文本内容。

> **图4-7 形象管理页面与图像风格化测试**

在参数配置功能测试中，验证了语音合成参数与面部驱动参数的配置流程。在视频生成配置页面上，用户可通过参数面板设置语速、采样策略、表情强度、输出分辨率、视频帧率以及面部增强算法类型等参数。测试中依次调整各项参数并提交配置，后端正确接收并将参数写入用户独立的配置文件中。随后启动视频生成，生成结果与配置参数的对应关系符合预期：调高语速后合成语音加快，增大表情强度后视频中人物表情变化更为明显，选择不同的面部增强算法后输出视频的面部清晰度与纹理风格产生相应差异。同时验证了驱动模式选择功能，在SadTalker与Wav2Lip两种模式之间切换后，系统能够正确启动对应的推理管线，输出与所选模式一致的生成结果。

在异步任务状态管理测试中，发起一次完整的视频生成任务，观察前后端之间的任务状态同步过程。任务提交后，后端立即返回任务标识，前端随即进入轮询模式，以固定时间间隔向后端发送状态查询请求。测试过程中监控了状态查询的请求日志，确认轮询间隔与预设值一致。在任务执行期间，前端界面显示全局处理进度提示框，包含当前正在执行的操作名称与进度百分比，同时页面上的重复操作按钮被禁用，防止用户重复提交。任务完成后，前端自动关闭进度提示并加载生成结果。此外，还测试了任务失败场景，当人为制造推理异常时，后端将任务状态标记为"失败"，前端在下一次轮询中检测到失败状态后弹出错误提示信息，引导用户排查问题。轮询超时保护机制同样通过测试验证，在超过设定的最大等待时间后，前端自动终止查询并向用户显示超时提示。

> **图4-8 视频生成过程中的进度反馈界面**

在生成结果展示与视频管理测试中，视频生成完成后进入视频列表页面，页面以卡片列表形式正确展示了所有已生成视频的基本信息，包括文件名称、创建时间与视频时长等。点击视频条目后，页面弹出视频播放器覆盖层，视频能够正常在线播放，画面与音频同步良好。执行视频下载操作后，浏览器成功下载视频文件至本地，文件完整性通过本地播放验证。执行视频删除操作后，系统弹出确认对话框，确认后视频从列表中移除，服务端文件同步删除，刷新页面后该视频不再出现于列表中。同时验证了质量评价结果的可视化展示功能，当视频对应的评分数据可用时，前端以可视化面板形式呈现了综合总分、质量等级标签、各分项指标得分、评测结论与优化建议等完整评价报告，展示效果清晰直观。

> **图4-9 视频列表页面与质量评价结果展示**

**（4）系统整体协同测试总结**

在完成各模块的独立功能测试后，对系统进行了端到端的完整流程测试，以验证三大核心模块在实际使用场景下的协同运行表现。

测试流程模拟了一次完整的数字人教学视频制作过程：首先登录系统并上传人像照片与PPT课件，完成参数配置后启动视频生成；系统依次执行语音合成、面部驱动渲染、视频背景处理与课件合成等环节，全程通过异步任务调度机制运行，前端实时展示处理进度；视频生成完成后，质量评价模块自动对生成视频进行多维度评分，评分结果与优化建议实时呈现于前端界面；根据评价报告中指出的薄弱维度，调整相关生成参数并重新启动视频生成流程，经过一轮参数优化后，新生成视频的评分在对应维度上有所提升，验证了"生成—评估—建议—调整—再生成"质量改进闭环的有效性。

此外，多用户并发测试表明，系统为每个登录用户维护的独立数据目录结构与任务状态记录能够有效隔离不同用户的数据与任务，两个用户同时发起视频生成请求时，各自的推理任务互不干扰，均能正常完成并输出正确结果，验证了系统在多用户并发场景下的数据隔离性与运行稳定性。

综合以上测试结果，数字人视频生成模块能够稳定完成从文本输入到视频输出的全流程处理，语音合成质量与面部驱动效果达到可用水平；生成视频质量评价模块能够自动完成多维度量化评分，评分结果合理可靠，优化建议具有针对性与可操作性；前后端交互模块实现了用户操作与系统功能之间的流畅衔接，异步任务管理机制运行稳定，生成结果的展示与管理功能完备。三大模块协同运行表现良好，系统整体具备稳定性、准确性与实用性，能够满足数字人教学视频自动化生成的实际应用需求，为后续的部署与推广奠定了坚实基础。
